---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const faqs = [
  { question: t("faq1.question"), answer: t("faq1.answer") },
  { question: t("faq2.question"), answer: t("faq2.answer") },
  { question: t("faq3.question"), answer: t("faq3.answer") },
  { question: t("faq4.question"), answer: t("faq4.answer") },
  { question: t("faq5.question"), answer: t("faq5.answer") },
  { question: t("faq6.question"), answer: t("faq6.answer") },
  { question: t("faq7.question"), answer: t("faq7.answer") },
  { question: t("faq8.question"), answer: t("faq8.answer") }
];
---

<section class="max-w-4xl mx-auto py-12 px-4 md:px-6" id="faq">
  <div class="text-center mb-12">
    <h2 class="text-2xl md:text-3xl font-bold mb-4 text-black">{t('faq.heading')}</h2>
    <p class="text-md md:text-lg text-gray-600">{t('faq.description')}</p>
  </div>
  <div class="space-y-4">
    {faqs.map((faq, index) => (
      <div class="faq-item bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200" data-faq-item>
        <button
          class="w-full flex justify-between items-center p-4 md:p-6 text-left hover:bg-gray-50 rounded-lg transition-colors duration-200"
          aria-expanded="false"
          aria-controls={`faq-answer-${index}`}
          data-faq-toggle
        >
          <h3 class="text-lg md:text-xl font-semibold text-black pr-4">{faq.question}</h3>
          <svg
            class="w-5 h-5 md:w-6 md:h-6 flex-shrink-0 text-gray-500 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            data-faq-icon
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </button>
        <div id={`faq-answer-${index}`} class="overflow-hidden transition-all duration-300 ease-in-out" style="max-height: 0" data-faq-content>
          <div class="px-4 md:px-6 pb-4 md:pb-6"><p class="text-md md:text-lg text-gray-600 leading-relaxed">{faq.answer}</p></div>
        </div>
      </div>
    ))}
  </div>
</section>

<script>
  function initFAQ() {
    const faqItems = document.querySelectorAll('[data-faq-item]');
    
    const closeAllItems = (except?: Element) => {
      faqItems.forEach(item => {
        if (item === except) return;
        
        const button = item.querySelector('[data-faq-toggle]') as HTMLButtonElement;
        const content = item.querySelector('[data-faq-content]') as HTMLElement;
        const icon = item.querySelector('[data-faq-icon]') as SVGElement;
        
        if (button && content && icon) {
          button.setAttribute('aria-expanded', 'false');
          content.style.maxHeight = '0';
          icon.style.transform = 'rotate(0deg)';
        }
      });
    };

    const toggleItem = (item: Element) => {
      const button = item.querySelector('[data-faq-toggle]') as HTMLButtonElement;
      const content = item.querySelector('[data-faq-content]') as HTMLElement;
      const icon = item.querySelector('[data-faq-icon]') as SVGElement;
      
      if (!button || !content || !icon) return;
      
      const isExpanded = button.getAttribute('aria-expanded') === 'true';
      
      if (isExpanded) {
        button.setAttribute('aria-expanded', 'false');
        content.style.maxHeight = '0';
        icon.style.transform = 'rotate(0deg)';
      } else {
        closeAllItems(item);
        button.setAttribute('aria-expanded', 'true');
        content.style.maxHeight = `${content.scrollHeight}px`;
        icon.style.transform = 'rotate(180deg)';
      }
    };

    faqItems.forEach(item => {
      const button = item.querySelector('[data-faq-toggle]');
      if (button) {
        button.addEventListener('click', () => toggleItem(item));
      }
    });
  }

  // Initialize FAQ functionality
  initFAQ();
  
  // Re-initialize on page navigation (for Astro view transitions)
  document.addEventListener('astro:page-load', initFAQ);
</script>